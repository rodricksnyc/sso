{"version":3,"file":"InputTimeSelect.js","names":["React","useMemo","forwardRef","useState","useEffect","styled","reduce","map","isFunction","find","trim","last","head","sortedIndex","throttle","Combobox","ComboboxInput","ComboboxList","ComboboxOption","pickAriaAndValidationProps","useReadOnlyWarn","formatTimeString","parseBase10Int","isValidTime","cycleHourDisplay","format","hour","formatLabel","minute","formattedHour","formattedMinute","period","generateMinuteIntervals","interval","minutes","Array","_","index","generateTimes","hours","result","hourWithMinutes","label","value","matchClosestMinute","timeCode","minuteOptions","now","Date","currentMinute","split","getMinutes","currentHour","getHours","optionBefore","optionAfter","roundedMinute","createOptionFromStringValue","convert12to24hr","createOptionFromLabel","toLowerCase","includes","numericTime","replace","hr24","undefined","matchStringValueToOption","options","option","matchStringLabelToOption","o","setScrollIntoView","selectedOption","scrollIntoView","arrowKeys","InputTimeSelectLayout","ref","className","onChange","onBlur","defaultValue","validationType","disabled","autoFocus","id","props","valueProp","console","error","timeOptions","setSelectedOption","inputTextValue","setInputTextValue","throttledHandleChange","newSelectedOption","newValue","trailing","handleTextInputChange","e","target","handleTextInputBlur","isNavigating","setIsNavigating","handleKeyDown","key","length","optionToFocus","timeOptionsFocused","ariaProps","displayName","InputTimeSelect"],"sources":["../../../../src/Form/Inputs/InputTimeSelect/InputTimeSelect.tsx"],"sourcesContent":["/*\n\n MIT License\n\n Copyright (c) 2022 Looker Data Sciences, Inc.\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in all\n copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n SOFTWARE.\n\n */\nimport type { KeyboardEvent, Ref, SyntheticEvent } from 'react'\nimport React, { useMemo, forwardRef, useState, useEffect } from 'react'\nimport styled from 'styled-components'\nimport reduce from 'lodash/reduce'\nimport map from 'lodash/map'\nimport isFunction from 'lodash/isFunction'\nimport find from 'lodash/find'\nimport trim from 'lodash/trim'\nimport last from 'lodash/last'\nimport head from 'lodash/head'\nimport sortedIndex from 'lodash/sortedIndex'\nimport throttle from 'lodash/throttle'\nimport type {\n  BorderProps,\n  SpaceProps,\n  CompatibleHTMLProps,\n} from '@looker/design-tokens'\nimport type {\n  ComboboxOptionObject,\n  MaybeComboboxOptionObject,\n} from '../Combobox/types'\nimport type { ValidationType } from '../../ValidationMessage'\nimport { Combobox } from '../Combobox'\nimport { ComboboxInput } from '../Combobox/ComboboxInput'\nimport { ComboboxList } from '../Combobox/ComboboxList'\nimport { ComboboxOption } from '../Combobox/ComboboxOption'\nimport { pickAriaAndValidationProps } from '../ariaProps'\nimport { useReadOnlyWarn } from '../../../utils'\nimport type { TimeFormats } from '../InputTime/utils'\nimport {\n  formatTimeString,\n  parseBase10Int,\n  isValidTime,\n} from '../InputTime/utils'\n\n/*\n * We've limited allowed intervals to a few approved options rather than\n * accepting any number. This is to protect against uninteded use where an\n * engineer might specify 1-minute intervals and generate an unusable\n * select box with 1400 options. We also wouldn't want to support bizarre\n * instances of a random numbers like 37 or 152 minute intervals.\n */\n\ntype intervals = 5 | 10 | 15 | 20 | 30 | 60\n\nexport interface InputTimeSelectProps\n  extends SpaceProps,\n    BorderProps,\n    Omit<CompatibleHTMLProps<HTMLDivElement>, 'value' | 'onChange'> {\n  format?: TimeFormats\n  interval?: intervals\n  defaultValue?: string\n  value?: string\n  onChange?: (val?: string) => void\n  onBlur?: () => void\n  validationType?: ValidationType\n  onValidationFail?: (value: string) => void\n}\n\n// if format is `12h`, repeat hours 1-12 twice\nconst cycleHourDisplay = (format: TimeFormats, hour: number) => {\n  if (format === '12h') {\n    if (hour === 0) {\n      return 12 // 12:00 am\n    } else if (hour > 12) {\n      return hour - 12 // 1:00 pm - 11:00 pm\n    }\n  }\n  return hour\n}\n\n// human readable value returned based on 12h or 24h formats\n// e.g. instead of 13:45 display \"01:45 pm\"\nconst formatLabel = (format: TimeFormats, hour: number, minute: number) => {\n  const formattedHour = formatTimeString(cycleHourDisplay(format, hour))\n  const formattedMinute = formatTimeString(minute)\n  const period = format === '12h' && (hour < 12 ? 'am' : 'pm')\n\n  return trim(`${formattedHour}:${formattedMinute} ${period || ''}`)\n}\n\n// generates all values from 0-60 that match provided interval setting\n// e.g. if interval is 15, return [0, 15, 30, 45]\nconst generateMinuteIntervals = (interval: intervals) => {\n  const minutes = new Array(60 / interval)\n  return map(minutes, (_, index) => formatTimeString(index * interval))\n}\n\n// generates all time options based on format and interval settings\nconst generateTimes = (format: TimeFormats, interval: intervals) => {\n  const hours = new Array(24)\n  const minutes = generateMinuteIntervals(interval)\n\n  return reduce(\n    hours,\n    (result: ComboboxOptionObject[], _, hour: number) => {\n      const formatLabel = format === '12h' && (hour < 12 ? 'am' : 'pm')\n      const formattedHour = formatTimeString(cycleHourDisplay(format, hour))\n\n      const hourWithMinutes: ComboboxOptionObject[] = map(\n        minutes,\n        (minute: string) => {\n          const label = trim(`${formattedHour}:${minute} ${formatLabel || ''}`)\n          const value = `${formatTimeString(hour)}:${minute}` // value always in 24hr time\n          return {\n            label,\n            value,\n          }\n        }\n      )\n      return [...result, ...hourWithMinutes]\n    },\n    []\n  )\n}\n\n// takes a non-normalized time value (e.g. 10:13) and rounds to the nearest valid interval (e.g. 10:15)\nconst matchClosestMinute = (interval: intervals, timeCode?: string) => {\n  const minuteOptions = map(generateMinuteIntervals(interval), parseBase10Int)\n  const now = new Date(Date.now()) // Include Date.now for easy test mocks\n  const currentMinute = timeCode\n    ? parseBase10Int(timeCode.split(':')[1])\n    : now.getMinutes()\n  const currentHour = timeCode\n    ? parseBase10Int(timeCode.split(':')[0])\n    : now.getHours()\n\n  // round current minute to closest option\n  const index = sortedIndex(minuteOptions, currentMinute)\n  const optionBefore =\n    minuteOptions[index - 1] || (head(minuteOptions) as number)\n  const optionAfter = minuteOptions[index] || (last(minuteOptions) as number)\n  const roundedMinute =\n    currentMinute - optionBefore < optionAfter - currentMinute\n      ? optionBefore\n      : optionAfter\n\n  // format and return time string\n  const formattedHour = formatTimeString(currentHour)\n  const formattedMinute = formatTimeString(roundedMinute)\n\n  return `${formattedHour}:${formattedMinute}`\n}\n\n// take in a string value ('03:45') and return a formatted option object\n// e.g. {label:'03:45 am', value: '03:45'}\nconst createOptionFromStringValue = (format: TimeFormats, value: string) => {\n  const [hour, minute] = map(value.split(':'), parseBase10Int)\n\n  return {\n    label: formatLabel(format, hour, minute),\n    value,\n  }\n}\n\n// convert times like \"2:00 pm\" or \"12:15 am\" to 24 hour equivalents\nconst convert12to24hr = (hour: number, period: 'am' | 'pm') => {\n  if (hour + period === '12am') {\n    return 0\n  } else if (period === 'pm' && hour < 12) {\n    return hour + 12\n  } else {\n    return hour\n  }\n}\n\n// take in a shorthand string label ('2pm') and return a formatted object\n// e.g. {label: '02:00 pm', value: '14:00'}\nconst createOptionFromLabel = (format: TimeFormats, label: string) => {\n  const period = label.toLowerCase().includes('p') ? 'pm' : 'am'\n  const numericTime = label.replace(/[apm]/gi, '')\n  const [hour = 0, minute = 0] = numericTime.split(':').map(parseBase10Int)\n  const hr24 = convert12to24hr(hour, period)\n  const value = `${formatTimeString(hr24)}:${formatTimeString(minute)}`\n\n  if (isValidTime(value)) {\n    return { label: formatLabel(format, hr24, minute), value }\n  }\n\n  return undefined\n}\n\n// pass in a string value ('03:45') and return full option object\n// e.g. {label:'03:45 am', value: '03:45'}\nconst matchStringValueToOption = (\n  options: ComboboxOptionObject[],\n  format: TimeFormats,\n  value?: string\n) => {\n  if (value && isValidTime(value)) {\n    const option = find(options, { value: value })\n    return option || createOptionFromStringValue(format, value)\n  }\n  return undefined\n}\n\n// take in a string label ('1:45 pm') and returns matching object\n// e.g. {label: '01:45 pm', value: '13:45'}\n// used in controlled components where value might not match the list of options\nconst matchStringLabelToOption = (\n  options: ComboboxOptionObject[],\n  label?: string\n) => {\n  if (label) {\n    return find(options, o => {\n      return o.label ? o.label.includes(label) : false\n    })\n  }\n  return undefined\n}\n\n// choose one option to scroll into visible menu area\n// adds {scrollIntoView: true} metadata to matching option\nconst setScrollIntoView = (\n  options: ComboboxOptionObject[],\n  interval: intervals,\n  selectedOption?: ComboboxOptionObject\n) => {\n  // CASE 1: scroll currently selected option into view\n  if (selectedOption) {\n    return map(options, option =>\n      matchClosestMinute(interval, selectedOption.value) === option.value\n        ? { ...option, scrollIntoView: true }\n        : option\n    )\n  }\n\n  // CASE 2: scroll current time into view\n  const now = matchClosestMinute(interval)\n  return map(options, option =>\n    option.value === now ? { ...option, scrollIntoView: true } : option\n  )\n}\n\nconst arrowKeys = ['ArrowDown', 'ArrowUp', 'ArrowRight', 'ArrowLeft']\n\nconst InputTimeSelectLayout = forwardRef(\n  (\n    {\n      className,\n      interval = 15,\n      format = '12h',\n      onChange,\n      onBlur,\n      value = '',\n      defaultValue,\n      validationType,\n      disabled,\n      autoFocus,\n      id,\n      ...props\n    }: InputTimeSelectProps,\n    ref: Ref<HTMLDivElement>\n  ) => {\n    useReadOnlyWarn('InputTimeSelect', value, onChange)\n    const valueProp = value || defaultValue\n    if (!isValidTime(valueProp)) {\n      // eslint-disable-next-line no-console\n      console.error(\n        `Invalid time (\"${valueProp}\") passed to <InputTimeSelect />. Value should be formatted as a 24-hour string (e.g. value=\"02:00\" or value=\"23:15\").`\n      )\n    }\n\n    const timeOptions = generateTimes(format, interval)\n\n    const [\n      selectedOption,\n      setSelectedOption,\n    ] = useState<MaybeComboboxOptionObject>()\n\n    const [inputTextValue, setInputTextValue] = useState('')\n\n    useEffect(() => {\n      // controlled component behavior: update state when value prop changes\n      setSelectedOption(\n        matchStringValueToOption(timeOptions, format, value || defaultValue)\n      )\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [value])\n\n    const throttledHandleChange = useMemo(\n      () =>\n        throttle(\n          (newSelectedOption: MaybeComboboxOptionObject) => {\n            setSelectedOption(newSelectedOption)\n            const newValue = newSelectedOption\n              ? newSelectedOption.value\n              : undefined\n            if (isFunction(onChange) && isValidTime(newValue)) {\n              onChange(newValue)\n            }\n          },\n          50,\n          { trailing: false }\n        ),\n      [onChange]\n    )\n\n    const handleTextInputChange = (e: SyntheticEvent) => {\n      setInputTextValue((e.target as HTMLInputElement).value)\n    }\n\n    const handleTextInputBlur = () => {\n      onBlur && onBlur()\n      setInputTextValue('')\n    }\n\n    const [isNavigating, setIsNavigating] = useState(false)\n\n    const handleKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\n      const { key } = e\n      if (arrowKeys.includes(key)) {\n        setIsNavigating(true)\n      } else if (key === 'Enter' || key === 'Tab') {\n        if (inputTextValue.length) {\n          // allow entering shortcuts like `2pm` to select `02:00 pm` on enter\n          const option = createOptionFromLabel(format, inputTextValue)\n          // don't fire change event here if user is selecting an option from the dropdown list\n          !isNavigating && throttledHandleChange(option)\n        }\n      } else {\n        setIsNavigating(false)\n      }\n    }\n\n    // scroll dropdown to relevant value\n    // inputTextValue: user input typeahead match\n    // selectedOption.value: current component state\n    // value: prop value passed in externally\n    const optionToFocus =\n      matchStringLabelToOption(timeOptions, inputTextValue) || selectedOption\n\n    const timeOptionsFocused = setScrollIntoView(\n      timeOptions,\n      interval,\n      optionToFocus\n    )\n\n    const ariaProps = pickAriaAndValidationProps(props)\n\n    return (\n      <Combobox\n        className={className}\n        ref={ref}\n        onChange={throttledHandleChange}\n        value={selectedOption}\n      >\n        <ComboboxInput\n          placeholder=\"Select time\"\n          onChange={handleTextInputChange}\n          onBlur={handleTextInputBlur}\n          onKeyDown={handleKeyDown}\n          autoComplete={false}\n          validationType={validationType}\n          disabled={disabled}\n          autoFocus={autoFocus}\n          id={id}\n          {...ariaProps}\n        />\n        <ComboboxList persistSelection>\n          {timeOptionsFocused.map((option, index) => (\n            <ComboboxOption {...option} key={index} />\n          ))}\n        </ComboboxList>\n      </Combobox>\n    )\n  }\n)\n\nInputTimeSelectLayout.displayName = 'InputTimeSelectLayout'\n\nexport const InputTimeSelect = styled(InputTimeSelectLayout)`\n  width: 100%;\n`\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0BA,OAAOA,KAAP,IAAgBC,OAAhB,EAAyBC,UAAzB,EAAqCC,QAArC,EAA+CC,SAA/C,QAAgE,OAAhE;AACA,OAAOC,MAAP,MAAmB,mBAAnB;AACA,OAAOC,MAAP,MAAmB,eAAnB;AACA,OAAOC,GAAP,MAAgB,YAAhB;AACA,OAAOC,UAAP,MAAuB,mBAAvB;AACA,OAAOC,IAAP,MAAiB,aAAjB;AACA,OAAOC,IAAP,MAAiB,aAAjB;AACA,OAAOC,IAAP,MAAiB,aAAjB;AACA,OAAOC,IAAP,MAAiB,aAAjB;AACA,OAAOC,WAAP,MAAwB,oBAAxB;AACA,OAAOC,QAAP,MAAqB,iBAArB;AAWA,SAASC,QAAT,QAAyB,aAAzB;AACA,SAASC,aAAT,QAA8B,2BAA9B;AACA,SAASC,YAAT,QAA6B,0BAA7B;AACA,SAASC,cAAT,QAA+B,4BAA/B;AACA,SAASC,0BAAT,QAA2C,cAA3C;AACA,SAASC,eAAT,QAAgC,gBAAhC;AAEA,SACEC,gBADF,EAEEC,cAFF,EAGEC,WAHF,QAIO,oBAJP;;AA+BA,IAAMC,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACC,MAAD,EAAsBC,IAAtB,EAAuC;EAC9D,IAAID,MAAM,KAAK,KAAf,EAAsB;IACpB,IAAIC,IAAI,KAAK,CAAb,EAAgB;MACd,OAAO,EAAP;IACD,CAFD,MAEO,IAAIA,IAAI,GAAG,EAAX,EAAe;MACpB,OAAOA,IAAI,GAAG,EAAd;IACD;EACF;;EACD,OAAOA,IAAP;AACD,CATD;;AAaA,IAAMC,WAAW,GAAG,SAAdA,WAAc,CAACF,MAAD,EAAsBC,IAAtB,EAAoCE,MAApC,EAAuD;EACzE,IAAMC,aAAa,GAAGR,gBAAgB,CAACG,gBAAgB,CAACC,MAAD,EAASC,IAAT,CAAjB,CAAtC;EACA,IAAMI,eAAe,GAAGT,gBAAgB,CAACO,MAAD,CAAxC;EACA,IAAMG,MAAM,GAAGN,MAAM,KAAK,KAAX,KAAqBC,IAAI,GAAG,EAAP,GAAY,IAAZ,GAAmB,IAAxC,CAAf;EAEA,OAAOhB,IAAI,WAAImB,aAAJ,cAAqBC,eAArB,cAAwCC,MAAM,IAAI,EAAlD,EAAX;AACD,CAND;;AAUA,IAAMC,uBAAuB,GAAG,SAA1BA,uBAA0B,CAACC,QAAD,EAAyB;EACvD,IAAMC,OAAO,GAAG,IAAIC,KAAJ,CAAU,KAAKF,QAAf,CAAhB;EACA,OAAO1B,GAAG,CAAC2B,OAAD,EAAU,UAACE,CAAD,EAAIC,KAAJ;IAAA,OAAchB,gBAAgB,CAACgB,KAAK,GAAGJ,QAAT,CAA9B;EAAA,CAAV,CAAV;AACD,CAHD;;AAMA,IAAMK,aAAa,GAAG,SAAhBA,aAAgB,CAACb,MAAD,EAAsBQ,QAAtB,EAA8C;EAClE,IAAMM,KAAK,GAAG,IAAIJ,KAAJ,CAAU,EAAV,CAAd;EACA,IAAMD,OAAO,GAAGF,uBAAuB,CAACC,QAAD,CAAvC;EAEA,OAAO3B,MAAM,CACXiC,KADW,EAEX,UAACC,MAAD,EAAiCJ,CAAjC,EAAoCV,IAApC,EAAqD;IACnD,IAAMC,WAAW,GAAGF,MAAM,KAAK,KAAX,KAAqBC,IAAI,GAAG,EAAP,GAAY,IAAZ,GAAmB,IAAxC,CAApB;IACA,IAAMG,aAAa,GAAGR,gBAAgB,CAACG,gBAAgB,CAACC,MAAD,EAASC,IAAT,CAAjB,CAAtC;IAEA,IAAMe,eAAuC,GAAGlC,GAAG,CACjD2B,OADiD,EAEjD,UAACN,MAAD,EAAoB;MAClB,IAAMc,KAAK,GAAGhC,IAAI,WAAImB,aAAJ,cAAqBD,MAArB,cAA+BD,WAAW,IAAI,EAA9C,EAAlB;MACA,IAAMgB,KAAK,aAAMtB,gBAAgB,CAACK,IAAD,CAAtB,cAAgCE,MAAhC,CAAX;MACA,OAAO;QACLc,KAAK,EAALA,KADK;QAELC,KAAK,EAALA;MAFK,CAAP;IAID,CATgD,CAAnD;IAWA,oCAAWH,MAAX,sBAAsBC,eAAtB;EACD,CAlBU,EAmBX,EAnBW,CAAb;AAqBD,CAzBD;;AA4BA,IAAMG,kBAAkB,GAAG,SAArBA,kBAAqB,CAACX,QAAD,EAAsBY,QAAtB,EAA4C;EACrE,IAAMC,aAAa,GAAGvC,GAAG,CAACyB,uBAAuB,CAACC,QAAD,CAAxB,EAAoCX,cAApC,CAAzB;EACA,IAAMyB,GAAG,GAAG,IAAIC,IAAJ,CAASA,IAAI,CAACD,GAAL,EAAT,CAAZ;EACA,IAAME,aAAa,GAAGJ,QAAQ,GAC1BvB,cAAc,CAACuB,QAAQ,CAACK,KAAT,CAAe,GAAf,EAAoB,CAApB,CAAD,CADY,GAE1BH,GAAG,CAACI,UAAJ,EAFJ;EAGA,IAAMC,WAAW,GAAGP,QAAQ,GACxBvB,cAAc,CAACuB,QAAQ,CAACK,KAAT,CAAe,GAAf,EAAoB,CAApB,CAAD,CADU,GAExBH,GAAG,CAACM,QAAJ,EAFJ;EAKA,IAAMhB,KAAK,GAAGxB,WAAW,CAACiC,aAAD,EAAgBG,aAAhB,CAAzB;EACA,IAAMK,YAAY,GAChBR,aAAa,CAACT,KAAK,GAAG,CAAT,CAAb,IAA6BzB,IAAI,CAACkC,aAAD,CADnC;EAEA,IAAMS,WAAW,GAAGT,aAAa,CAACT,KAAD,CAAb,IAAyB1B,IAAI,CAACmC,aAAD,CAAjD;EACA,IAAMU,aAAa,GACjBP,aAAa,GAAGK,YAAhB,GAA+BC,WAAW,GAAGN,aAA7C,GACIK,YADJ,GAEIC,WAHN;EAMA,IAAM1B,aAAa,GAAGR,gBAAgB,CAAC+B,WAAD,CAAtC;EACA,IAAMtB,eAAe,GAAGT,gBAAgB,CAACmC,aAAD,CAAxC;EAEA,iBAAU3B,aAAV,cAA2BC,eAA3B;AACD,CAzBD;;AA6BA,IAAM2B,2BAA2B,GAAG,SAA9BA,2BAA8B,CAAChC,MAAD,EAAsBkB,KAAtB,EAAwC;EAC1E,WAAuBpC,GAAG,CAACoC,KAAK,CAACO,KAAN,CAAY,GAAZ,CAAD,EAAmB5B,cAAnB,CAA1B;EAAA;EAAA,IAAOI,IAAP;EAAA,IAAaE,MAAb;;EAEA,OAAO;IACLc,KAAK,EAAEf,WAAW,CAACF,MAAD,EAASC,IAAT,EAAeE,MAAf,CADb;IAELe,KAAK,EAALA;EAFK,CAAP;AAID,CAPD;;AAUA,IAAMe,eAAe,GAAG,SAAlBA,eAAkB,CAAChC,IAAD,EAAeK,MAAf,EAAuC;EAC7D,IAAIL,IAAI,GAAGK,MAAP,KAAkB,MAAtB,EAA8B;IAC5B,OAAO,CAAP;EACD,CAFD,MAEO,IAAIA,MAAM,KAAK,IAAX,IAAmBL,IAAI,GAAG,EAA9B,EAAkC;IACvC,OAAOA,IAAI,GAAG,EAAd;EACD,CAFM,MAEA;IACL,OAAOA,IAAP;EACD;AACF,CARD;;AAYA,IAAMiC,qBAAqB,GAAG,SAAxBA,qBAAwB,CAAClC,MAAD,EAAsBiB,KAAtB,EAAwC;EACpE,IAAMX,MAAM,GAAGW,KAAK,CAACkB,WAAN,GAAoBC,QAApB,CAA6B,GAA7B,IAAoC,IAApC,GAA2C,IAA1D;EACA,IAAMC,WAAW,GAAGpB,KAAK,CAACqB,OAAN,CAAc,SAAd,EAAyB,EAAzB,CAApB;;EACA,4BAA+BD,WAAW,CAACZ,KAAZ,CAAkB,GAAlB,EAAuB3C,GAAvB,CAA2Be,cAA3B,CAA/B;EAAA;EAAA;EAAA,IAAOI,IAAP,uCAAc,CAAd;EAAA;EAAA,IAAiBE,MAAjB,uCAA0B,CAA1B;;EACA,IAAMoC,IAAI,GAAGN,eAAe,CAAChC,IAAD,EAAOK,MAAP,CAA5B;EACA,IAAMY,KAAK,aAAMtB,gBAAgB,CAAC2C,IAAD,CAAtB,cAAgC3C,gBAAgB,CAACO,MAAD,CAAhD,CAAX;;EAEA,IAAIL,WAAW,CAACoB,KAAD,CAAf,EAAwB;IACtB,OAAO;MAAED,KAAK,EAAEf,WAAW,CAACF,MAAD,EAASuC,IAAT,EAAepC,MAAf,CAApB;MAA4Ce,KAAK,EAALA;IAA5C,CAAP;EACD;;EAED,OAAOsB,SAAP;AACD,CAZD;;AAgBA,IAAMC,wBAAwB,GAAG,SAA3BA,wBAA2B,CAC/BC,OAD+B,EAE/B1C,MAF+B,EAG/BkB,KAH+B,EAI5B;EACH,IAAIA,KAAK,IAAIpB,WAAW,CAACoB,KAAD,CAAxB,EAAiC;IAC/B,IAAMyB,MAAM,GAAG3D,IAAI,CAAC0D,OAAD,EAAU;MAAExB,KAAK,EAAEA;IAAT,CAAV,CAAnB;IACA,OAAOyB,MAAM,IAAIX,2BAA2B,CAAChC,MAAD,EAASkB,KAAT,CAA5C;EACD;;EACD,OAAOsB,SAAP;AACD,CAVD;;AAeA,IAAMI,wBAAwB,GAAG,SAA3BA,wBAA2B,CAC/BF,OAD+B,EAE/BzB,KAF+B,EAG5B;EACH,IAAIA,KAAJ,EAAW;IACT,OAAOjC,IAAI,CAAC0D,OAAD,EAAU,UAAAG,CAAC,EAAI;MACxB,OAAOA,CAAC,CAAC5B,KAAF,GAAU4B,CAAC,CAAC5B,KAAF,CAAQmB,QAAR,CAAiBnB,KAAjB,CAAV,GAAoC,KAA3C;IACD,CAFU,CAAX;EAGD;;EACD,OAAOuB,SAAP;AACD,CAVD;;AAcA,IAAMM,iBAAiB,GAAG,SAApBA,iBAAoB,CACxBJ,OADwB,EAExBlC,QAFwB,EAGxBuC,cAHwB,EAIrB;EAEH,IAAIA,cAAJ,EAAoB;IAClB,OAAOjE,GAAG,CAAC4D,OAAD,EAAU,UAAAC,MAAM;MAAA,OACxBxB,kBAAkB,CAACX,QAAD,EAAWuC,cAAc,CAAC7B,KAA1B,CAAlB,KAAuDyB,MAAM,CAACzB,KAA9D,mCACSyB,MADT;QACiBK,cAAc,EAAE;MADjC,KAEIL,MAHoB;IAAA,CAAhB,CAAV;EAKD;;EAGD,IAAMrB,GAAG,GAAGH,kBAAkB,CAACX,QAAD,CAA9B;EACA,OAAO1B,GAAG,CAAC4D,OAAD,EAAU,UAAAC,MAAM;IAAA,OACxBA,MAAM,CAACzB,KAAP,KAAiBI,GAAjB,mCAA4BqB,MAA5B;MAAoCK,cAAc,EAAE;IAApD,KAA6DL,MADrC;EAAA,CAAhB,CAAV;AAGD,CAnBD;;AAqBA,IAAMM,SAAS,GAAG,CAAC,WAAD,EAAc,SAAd,EAAyB,YAAzB,EAAuC,WAAvC,CAAlB;AAEA,IAAMC,qBAAqB,GAAGzE,UAAU,CACtC,gBAeE0E,GAfF,EAgBK;EAAA,IAdDC,SAcC,QAdDA,SAcC;EAAA,yBAbD5C,QAaC;EAAA,IAbDA,QAaC,8BAbU,EAaV;EAAA,uBAZDR,MAYC;EAAA,IAZDA,MAYC,4BAZQ,KAYR;EAAA,IAXDqD,QAWC,QAXDA,QAWC;EAAA,IAVDC,MAUC,QAVDA,MAUC;EAAA,sBATDpC,KASC;EAAA,IATDA,KASC,2BATO,EASP;EAAA,IARDqC,YAQC,QARDA,YAQC;EAAA,IAPDC,cAOC,QAPDA,cAOC;EAAA,IANDC,QAMC,QANDA,QAMC;EAAA,IALDC,SAKC,QALDA,SAKC;EAAA,IAJDC,EAIC,QAJDA,EAIC;EAAA,IAHEC,KAGF;;EACHjE,eAAe,CAAC,iBAAD,EAAoBuB,KAApB,EAA2BmC,QAA3B,CAAf;EACA,IAAMQ,SAAS,GAAG3C,KAAK,IAAIqC,YAA3B;;EACA,IAAI,CAACzD,WAAW,CAAC+D,SAAD,CAAhB,EAA6B;IAE3BC,OAAO,CAACC,KAAR,2BACoBF,SADpB;EAGD;;EAED,IAAMG,WAAW,GAAGnD,aAAa,CAACb,MAAD,EAASQ,QAAT,CAAjC;;EAEA,gBAGI9B,QAAQ,EAHZ;EAAA;EAAA,IACEqE,cADF;EAAA,IAEEkB,iBAFF;;EAKA,iBAA4CvF,QAAQ,CAAC,EAAD,CAApD;EAAA;EAAA,IAAOwF,cAAP;EAAA,IAAuBC,iBAAvB;;EAEAxF,SAAS,CAAC,YAAM;IAEdsF,iBAAiB,CACfxB,wBAAwB,CAACuB,WAAD,EAAchE,MAAd,EAAsBkB,KAAK,IAAIqC,YAA/B,CADT,CAAjB;EAID,CANQ,EAMN,CAACrC,KAAD,CANM,CAAT;EAQA,IAAMkD,qBAAqB,GAAG5F,OAAO,CACnC;IAAA,OACEa,QAAQ,CACN,UAACgF,iBAAD,EAAkD;MAChDJ,iBAAiB,CAACI,iBAAD,CAAjB;MACA,IAAMC,QAAQ,GAAGD,iBAAiB,GAC9BA,iBAAiB,CAACnD,KADY,GAE9BsB,SAFJ;;MAGA,IAAIzD,UAAU,CAACsE,QAAD,CAAV,IAAwBvD,WAAW,CAACwE,QAAD,CAAvC,EAAmD;QACjDjB,QAAQ,CAACiB,QAAD,CAAR;MACD;IACF,CATK,EAUN,EAVM,EAWN;MAAEC,QAAQ,EAAE;IAAZ,CAXM,CADV;EAAA,CADmC,EAenC,CAAClB,QAAD,CAfmC,CAArC;;EAkBA,IAAMmB,qBAAqB,GAAG,SAAxBA,qBAAwB,CAACC,CAAD,EAAuB;IACnDN,iBAAiB,CAAEM,CAAC,CAACC,MAAH,CAA+BxD,KAAhC,CAAjB;EACD,CAFD;;EAIA,IAAMyD,mBAAmB,GAAG,SAAtBA,mBAAsB,GAAM;IAChCrB,MAAM,IAAIA,MAAM,EAAhB;IACAa,iBAAiB,CAAC,EAAD,CAAjB;EACD,CAHD;;EAKA,iBAAwCzF,QAAQ,CAAC,KAAD,CAAhD;EAAA;EAAA,IAAOkG,YAAP;EAAA,IAAqBC,eAArB;;EAEA,IAAMC,aAAa,GAAG,SAAhBA,aAAgB,CAACL,CAAD,EAAwC;IAC5D,IAAQM,GAAR,GAAgBN,CAAhB,CAAQM,GAAR;;IACA,IAAI9B,SAAS,CAACb,QAAV,CAAmB2C,GAAnB,CAAJ,EAA6B;MAC3BF,eAAe,CAAC,IAAD,CAAf;IACD,CAFD,MAEO,IAAIE,GAAG,KAAK,OAAR,IAAmBA,GAAG,KAAK,KAA/B,EAAsC;MAC3C,IAAIb,cAAc,CAACc,MAAnB,EAA2B;QAEzB,IAAMrC,MAAM,GAAGT,qBAAqB,CAAClC,MAAD,EAASkE,cAAT,CAApC;QAEA,CAACU,YAAD,IAAiBR,qBAAqB,CAACzB,MAAD,CAAtC;MACD;IACF,CAPM,MAOA;MACLkC,eAAe,CAAC,KAAD,CAAf;IACD;EACF,CAdD;;EAoBA,IAAMI,aAAa,GACjBrC,wBAAwB,CAACoB,WAAD,EAAcE,cAAd,CAAxB,IAAyDnB,cAD3D;EAGA,IAAMmC,kBAAkB,GAAGpC,iBAAiB,CAC1CkB,WAD0C,EAE1CxD,QAF0C,EAG1CyE,aAH0C,CAA5C;EAMA,IAAME,SAAS,GAAGzF,0BAA0B,CAACkE,KAAD,CAA5C;EAEA,OACE,oBAAC,QAAD;IACE,SAAS,EAAER,SADb;IAEE,GAAG,EAAED,GAFP;IAGE,QAAQ,EAAEiB,qBAHZ;IAIE,KAAK,EAAErB;EAJT,GAME,oBAAC,aAAD;IACE,WAAW,EAAC,aADd;IAEE,QAAQ,EAAEyB,qBAFZ;IAGE,MAAM,EAAEG,mBAHV;IAIE,SAAS,EAAEG,aAJb;IAKE,YAAY,EAAE,KALhB;IAME,cAAc,EAAEtB,cANlB;IAOE,QAAQ,EAAEC,QAPZ;IAQE,SAAS,EAAEC,SARb;IASE,EAAE,EAAEC;EATN,GAUMwB,SAVN,EANF,EAkBE,oBAAC,YAAD;IAAc,gBAAgB;EAA9B,GACGD,kBAAkB,CAACpG,GAAnB,CAAuB,UAAC6D,MAAD,EAAS/B,KAAT;IAAA,OACtB,oBAAC,cAAD,eAAoB+B,MAApB;MAA4B,GAAG,EAAE/B;IAAjC,GADsB;EAAA,CAAvB,CADH,CAlBF,CADF;AA0BD,CAlIqC,CAAxC;AAqIAsC,qBAAqB,CAACkC,WAAtB,GAAoC,uBAApC;AAEA,OAAO,IAAMC,eAAe,GAAGzG,MAAM,CAACsE,qBAAD,CAAT;EAAA;EAAA;AAAA,mBAArB"}