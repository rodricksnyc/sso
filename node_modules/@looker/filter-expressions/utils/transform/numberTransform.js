import "core-js/modules/es.array.filter.js";
import cloneDeep from 'lodash/cloneDeep';
import { NumberTypes } from '../../types/number_types';
import { serializeNumberNode } from '../number/number_to_string';
import { inorderTraversal, removeNode, treeToList } from '../tree';
import { mergeMultiValueNodes } from './mergeMultiValueNodes';
import applyId from './utils/apply_id_to_ast';

var countNots = function countNots(root) {
  var count = 0;
  inorderTraversal(root, function (node) {
    if (node.is === false) {
      count += 1;
    }
  });
  return count;
};

var removeDuplicateNotNodes = function removeDuplicateNotNodes(root) {
  var workingRoot = cloneDeep(applyId(root));
  var andClauses = treeToList(workingRoot).filter(function (item) {
    return item.is === false;
  });
  return andClauses.length === 2 && serializeNumberNode(andClauses[0]) === serializeNumberNode(andClauses[1]) ? removeNode(workingRoot, andClauses[1].id) : workingRoot;
};

export var numberTransform = function numberTransform(root) {
  var countOfNotNodes = countNots(root);
  var mergeNodesWithDifferentIsValue = countOfNotNodes === 1;
  var mergedRoot = mergeMultiValueNodes(root, NumberTypes.EQUAL, mergeNodesWithDifferentIsValue);
  var checkForDuplicates = countOfNotNodes === 2;
  return checkForDuplicates ? removeDuplicateNotNodes(mergedRoot) : mergedRoot;
};
//# sourceMappingURL=numberTransform.js.map