{"version":3,"file":"control_filter_utils.js","names":["addDays","dateToFilterDateTimeModel","filterDateTimeModelToDate","isArray","keyBy","partition","ButtonToggles","ButtonGroup","CheckboxGroup","DateInput","DateRange","DayRangeInput","RelativeTimeframes","filterModelToRelativeTimeframeModel","relativeTimeframeModelToFilterModel","DropdownMenu","RadioGroup","RangeSlider","Slider","TagList","createEnumeration","createOptions","filterMaxMap","button_group","button_toggles","checkboxes","radio_buttons","maxForFilterType","type","getStringOptions","field","suggestions","enumerations","config","options","escapeEnumerationVaues","has_allowed_values","parameter","stringOptions","noOptions","length","map","filter","value","includes","getPartitionedOptions","item","optionsMap","valueGroups","String","getMultiStringSelectChange","changeFilter","Number","id","buttonGroupAdapter","isLoading","props","included","excluded","onChange","max","checkboxGroupAdapter","adapterProps","getSingleValue","onlyValuesFromOptions","fieldCategory","singleValue","getSingleStringSelectChange","buttonTogglesAdapter","category","relativeTimeframesAdapter","start","end","undefined","relativeTimeframeValue","relativeTimeframeOnChange","relativeTimeframe","newItem","dateInputAdapter","date","dateValue","dateChange","dateModel","dayRangeInputAdapter","dateRangeValue","from","to","dateRangeChange","startDateModel","translatedTo","endDateModel","dateRangeAdapter","dateTimeRangeValue","dateTimeRangeChange","showTime","sliderAdapter","sliderValue","sliderChange","rangeSliderAdapter","low","high","rangeSliderValue","min","rangeSliderChange","range","bounds","name","dropdownMenuAdapter","onInputChange","tokenStyle","display","tagListAdapter","values","radioGroupAdapter","getControlFilterInfo","Component","adapter","filterTokenAdapterMap","date_time_range_input","day_picker","day_range_picker","dropdown_menu","range_slider","relative_timeframes","slider","tag_list","TEST_ONLY"],"sources":["../../../src/Filter/utils/control_filter_utils.ts"],"sourcesContent":["/*\n\n MIT License\n\n Copyright (c) 2022 Looker Data Sciences, Inc.\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in all\n copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n SOFTWARE.\n\n */\nimport type React from 'react'\nimport type { FilterModel } from '@looker/filter-expressions'\nimport {\n  addDays,\n  dateToFilterDateTimeModel,\n  filterDateTimeModelToDate,\n} from '@looker/filter-expressions'\nimport isArray from 'lodash/isArray'\nimport keyBy from 'lodash/keyBy'\nimport partition from 'lodash/partition'\n\nimport { ButtonToggles } from '../components/ControlFilter/components/ButtonToggles'\nimport { ButtonGroup } from '../components/ControlFilter/components/ButtonGroup'\nimport { CheckboxGroup } from '../components/ControlFilter/components/CheckboxGroup'\nimport { DateInput } from '../components/AdvancedFilter/components/DateFilter/components/DateInput'\nimport { DateRange } from '../components/AdvancedFilter/components/DateFilter/components/DateRange'\nimport { DayRangeInput } from '../components/AdvancedFilter/components/DateFilter/components/DayRangeInput'\nimport { RelativeTimeframes } from '../components/AdvancedFilter/components/DateFilter/components/RelativeTimeframes'\nimport type { RelativeTimeframeModel } from '../components/AdvancedFilter/components/DateFilter/types/relative_timeframe_types'\nimport {\n  filterModelToRelativeTimeframeModel,\n  relativeTimeframeModelToFilterModel,\n} from '../components/AdvancedFilter/components/DateFilter/utils/relative_timeframe_conversions'\nimport { DropdownMenu } from '../components/ControlFilter/components/DropdownMenu'\nimport { RadioGroup } from '../components/ControlFilter/components/RadioGroup'\nimport {\n  RangeSlider,\n  Slider,\n} from '../components/ControlFilter/components/Slider'\nimport type {\n  RangeSliderProps,\n  SliderProps,\n} from '../components/ControlFilter/components/Slider/types'\nimport { TagList } from '../components/ControlFilter/components/TagList'\nimport type { Option } from '../types/option'\nimport { createEnumeration, createOptions } from './option_utils'\nimport type { FilterProps, InternalFilterProps } from '../types/filter_props'\n\ninterface AdapterProps extends Omit<FilterProps, 'expression'> {\n  changeFilter: InternalFilterProps['changeFilter']\n}\n\ninterface FilterMaxes {\n  button_group: number\n  button_toggles: number\n  checkboxes: number\n  radio_buttons: number\n  [key: string]: number\n}\n\n/**\n * Defines the max number of options allowed for the defined options.\n * If a type is not defined, means it has no concept of max.\n */\nconst filterMaxMap: FilterMaxes = {\n  button_group: 30,\n  button_toggles: 30,\n  checkboxes: 50,\n  radio_buttons: 50,\n}\n\n/**\n * Returns the max number of options for a given filter type. Can be undefined\n */\nexport const maxForFilterType = (type: string) => filterMaxMap[type]\n\nconst getStringOptions = ({\n  field,\n  suggestions,\n  enumerations,\n  config,\n}: AdapterProps): Option[] => {\n  const options = config?.options\n  const escapeEnumerationVaues = field?.has_allowed_values && field?.parameter\n  let stringOptions: Option[] = []\n  const noOptions = !(isArray(options) && options.length > 0)\n\n  if (noOptions && suggestions && suggestions.length !== 0) {\n    stringOptions = createOptions(suggestions)\n  } else if (noOptions && enumerations) {\n    stringOptions = enumerations.map(createEnumeration(escapeEnumerationVaues))\n  } else if (isArray(options)) {\n    if (enumerations && enumerations.length > 0) {\n      stringOptions = enumerations\n        .map(createEnumeration(escapeEnumerationVaues))\n        .filter(({ value }) => options.includes(value))\n    } else {\n      stringOptions = createOptions(options)\n    }\n  }\n\n  return stringOptions\n}\n\nconst getPartitionedOptions = (\n  item: FilterModel,\n  optionsMap: { [key: string]: Option }\n) => {\n  // Partition out values that are included in the options array and those\n  // that are not.\n  const valueGroups: string[][] = isArray(item.value)\n    ? partition(item.value.map(String), (value) => optionsMap[value])\n    : [[], []]\n  return valueGroups\n}\n\n// Multi Selects\n\n// When suggestions/options are empty for checkboxes/button_groups (may not have fully loaded yet)\n// but filter values exists, return filter values.\nconst getMultiStringSelectChange = (\n  item: FilterModel,\n  changeFilter: AdapterProps['changeFilter']\n) => (value: string[]) => changeFilter(Number(item.id), { ...item, value })\n\n/**\n * Adapter for Button Group props\n */\nconst buttonGroupAdapter: FilterTokenAdapter<typeof ButtonGroup> = (\n  item: FilterModel,\n  { isLoading, ...props }: AdapterProps\n): React.ComponentProps<typeof ButtonGroup> => {\n  const stringOptions = getStringOptions(props)\n  const optionsMap = keyBy(stringOptions, 'value')\n  const [included, excluded] = getPartitionedOptions(item, optionsMap)\n  // When suggestions/options are empty for checkboxes/button_groups (may not have fully loaded yet)\n  // but filter values exists, return filter values.\n  const value = included.length ? included : excluded\n  const changeFilter = props.changeFilter\n\n  return {\n    onChange: getMultiStringSelectChange(item, changeFilter),\n    value,\n    options: stringOptions,\n    max: maxForFilterType('button_group'),\n    isLoading,\n  }\n}\n\n/**\n * Returns the props needed to render a Checkbox Group control\n * @param item\n * @param props\n */\nconst checkboxGroupAdapter: FilterTokenAdapter<typeof CheckboxGroup> = (\n  item: FilterModel,\n  { isLoading, ...props }: AdapterProps\n): React.ComponentProps<typeof CheckboxGroup> => {\n  const adapterProps = buttonGroupAdapter(item, props)\n  const { onChange, value, options } = adapterProps\n  return {\n    onChange,\n    value,\n    options,\n    max: maxForFilterType('checkboxes'),\n    isLoading,\n  }\n}\n\nconst getSingleValue = (\n  item: FilterModel,\n  stringOptions: Option[],\n  onlyValuesFromOptions: boolean,\n  fieldCategory?: string | null\n) => {\n  const optionsMap = keyBy(stringOptions, 'value')\n\n  /**\n   * Many filter components use only values that are present in options,\n   * but at least one (DropdownMenu) can use values that are not present in options\n   * (typically because there are 1000+ suggestions)\n   */\n  let singleValue: string\n  if (onlyValuesFromOptions) {\n    // If the value does not appear in options, return an empty string\n    singleValue = String(\n      item.value?.length && optionsMap[item.value[0]] ? item.value[0] : ''\n    )\n  } else {\n    // If filter has a value, include it, regardless of whether it exists in options\n    singleValue = item.value?.length ? String(item.value[0]) : ''\n  }\n\n  if (\n    fieldCategory === 'parameter' &&\n    singleValue === '' &&\n    stringOptions &&\n    stringOptions.length\n  ) {\n    singleValue = stringOptions[0].value\n  }\n\n  return singleValue\n}\n\nconst getSingleStringSelectChange = (\n  item: FilterModel,\n  changeFilter: AdapterProps['changeFilter']\n) => (value: string) => {\n  changeFilter(Number(item.id), { ...item, value: [value] })\n}\n\n/**\n * Returns the props needed to render a Button Toggle control\n * @param item\n * @param props\n */\nconst buttonTogglesAdapter = (\n  item: FilterModel,\n  { isLoading, ...props }: AdapterProps\n): React.ComponentProps<typeof ButtonToggles> => {\n  const { changeFilter, field } = props\n  const stringOptions = getStringOptions(props)\n  const value = getSingleValue(item, stringOptions, true, field?.category)\n\n  return {\n    onChange: getSingleStringSelectChange(item, changeFilter),\n    value,\n    options: stringOptions,\n    isLoading,\n    // TODO: max: maxForFilterType('button_toggles'),\n  }\n}\n\nconst relativeTimeframesAdapter = (\n  item: FilterModel,\n  props: AdapterProps\n): React.ComponentProps<typeof RelativeTimeframes> | undefined => {\n  if (item.type === 'range' && (item.start == null || item.end == null)) {\n    return undefined\n  }\n  const { changeFilter } = props\n  // Relative Timeframes\n  const relativeTimeframeValue = filterModelToRelativeTimeframeModel(item)\n  if (relativeTimeframeValue === undefined) {\n    return undefined\n  }\n  const relativeTimeframeOnChange = (\n    relativeTimeframe: RelativeTimeframeModel\n  ) => {\n    const newItem = relativeTimeframeModelToFilterModel(relativeTimeframe)\n    changeFilter(Number(item.id), { ...item, ...newItem })\n  }\n  return {\n    onChange: relativeTimeframeOnChange,\n    value: relativeTimeframeValue,\n  }\n}\n\n/**\n * Builds the props for the DateInput control\n */\nconst dateInputAdapter = (\n  item: FilterModel,\n  props: AdapterProps\n): React.ComponentProps<typeof DateInput> | undefined => {\n  if (item.date == null) {\n    return undefined\n  }\n  const { changeFilter } = props\n\n  // Day Picker\n  const dateValue = filterDateTimeModelToDate(item.date)\n  const dateChange = (date: Date) => {\n    const dateModel = dateToFilterDateTimeModel(date)\n    changeFilter(Number(item.id), { ...item, type: 'on', date: dateModel })\n  }\n  return {\n    onChange: dateChange,\n    date: dateValue,\n  }\n}\n\n/**\n * Builds the props for the DayRangeInput control\n */\nconst dayRangeInputAdapter = (\n  item: FilterModel,\n  props: AdapterProps\n): React.ComponentProps<typeof DayRangeInput> | undefined => {\n  if (item.start == null || item.end == null) {\n    return undefined\n  }\n  const { changeFilter } = props\n\n  // Day Range Picker\n  const dateRangeValue = {\n    from: filterDateTimeModelToDate(item.start),\n    to: addDays(filterDateTimeModelToDate(item.end), -1), // DateRange is inclusive, grammar is exclusive\n  }\n  const dateRangeChange = ({ from, to }: { from: Date; to: Date }) => {\n    const startDateModel = dateToFilterDateTimeModel(from)\n    // DateRange is inclusive, grammar is exclusive\n    const translatedTo = addDays(to, 1)\n    const endDateModel = dateToFilterDateTimeModel(translatedTo)\n\n    changeFilter(Number(item.id), {\n      ...item,\n      start: startDateModel,\n      end: endDateModel,\n      type: 'range',\n    })\n  }\n\n  return {\n    onChange: dateRangeChange,\n    value: dateRangeValue,\n  }\n}\n\n/**\n * Builds the props for the DateRange control\n */\nconst dateRangeAdapter = (\n  item: FilterModel,\n  props: AdapterProps\n): React.ComponentProps<typeof DateRange> | undefined => {\n  if (item.start == null || item.end == null) {\n    return undefined\n  }\n  // Date/Time Range input\n  const dateTimeRangeValue = {\n    ...item,\n    id: item.id || '',\n    start: item.start,\n    end: item.end,\n  } as FilterModel\n\n  const { changeFilter } = props\n\n  const dateTimeRangeChange = (id: string, item: Partial<FilterModel>) => {\n    const { from, to } = item\n    const startDateModel = dateToFilterDateTimeModel(from)\n    // DateRange is inclusive, grammar is exclusive\n    const translatedTo = addDays(to, 1)\n    const endDateModel = dateToFilterDateTimeModel(translatedTo)\n\n    changeFilter(Number(id), {\n      ...(item as FilterModel),\n      start: startDateModel,\n      end: endDateModel,\n      type: 'range',\n    })\n  }\n\n  return {\n    onChange: dateTimeRangeChange,\n    item: dateTimeRangeValue,\n    showTime: true,\n  }\n}\n\nconst sliderAdapter = (\n  item: FilterModel,\n  props: AdapterProps\n): React.ComponentProps<typeof Slider> | undefined => {\n  if (item.value?.length !== 1) {\n    return undefined\n  }\n  const { changeFilter, config } = props\n  // Slider\n  const sliderValue: number = item.value[0]\n  const sliderChange = (value: SliderProps['value']) => {\n    changeFilter(Number(item.id), { ...item, type: '=', value: [value] })\n  }\n\n  return {\n    onChange: sliderChange,\n    value: sliderValue,\n    options: config?.options as SliderProps['options'],\n  }\n}\n\nconst rangeSliderAdapter = (\n  item: FilterModel,\n  props: AdapterProps\n): React.ComponentProps<typeof RangeSlider> | undefined => {\n  if (item.low == null || item.high == null) {\n    return undefined\n  }\n  const { changeFilter, config } = props\n  // Range Slider\n  const rangeSliderValue: RangeSliderProps['value'] = {\n    min: item.low,\n    max: item.high,\n  }\n  const rangeSliderChange = (range: RangeSliderProps['value']) => {\n    changeFilter(Number(item.id), {\n      ...item,\n      bounds: '[]',\n      low: range.min,\n      high: range.max,\n      type: 'between',\n    })\n  }\n\n  return {\n    value: rangeSliderValue,\n    options: config?.options as RangeSliderProps['options'],\n    onChange: rangeSliderChange,\n    name: props.name,\n  }\n}\n\n/**\n * Returns the props needed to render a Dropdown Menu control\n * @param item\n * @param props\n */\nconst dropdownMenuAdapter = (\n  item: FilterModel,\n  props: AdapterProps\n): React.ComponentProps<typeof DropdownMenu> => {\n  const { changeFilter, config, field, isLoading, onInputChange } = props\n  const stringOptions = getStringOptions(props)\n  const value = getSingleValue(item, stringOptions, false, field?.category)\n  const tokenStyle = config?.display !== 'popover'\n\n  return {\n    onChange: getSingleStringSelectChange(item, changeFilter),\n    isLoading,\n    onInputChange,\n    value,\n    options: stringOptions,\n    max: maxForFilterType('dropdown_menu'),\n    tokenStyle,\n  }\n}\n\n/**\n * Returns the props needed to render a TagList control\n * @param item\n * @param props\n */\nconst tagListAdapter = (\n  item: FilterModel,\n  props: AdapterProps\n): React.ComponentProps<typeof TagList> => {\n  const { changeFilter, config, isLoading, onInputChange } = props\n\n  const stringOptions = getStringOptions(props)\n  const optionsMap = keyBy(stringOptions, 'value')\n  const [included, excluded] = getPartitionedOptions(item, optionsMap)\n  const values = [...included, ...excluded]\n\n  const tokenStyle = config?.display !== 'popover'\n\n  return {\n    onChange: getMultiStringSelectChange(item, changeFilter),\n    onInputChange,\n    value: values,\n    options: stringOptions,\n    max: maxForFilterType('tag_list'),\n    isLoading,\n    tokenStyle,\n  }\n}\n\n/**\n * Returns the props needed to render a Radio Group control\n * @param item\n * @param props\n */\nconst radioGroupAdapter = (\n  item: FilterModel,\n  { isLoading, ...props }: AdapterProps\n): React.ComponentProps<typeof RadioGroup> => {\n  const { changeFilter, field } = props\n  const stringOptions = getStringOptions(props)\n  const value = getSingleValue(item, stringOptions, true, field?.category)\n\n  return {\n    onChange: getSingleStringSelectChange(item, changeFilter),\n    value,\n    options: stringOptions,\n    max: maxForFilterType('radio_buttons'),\n    isLoading,\n  }\n}\n\nexport const getControlFilterInfo = (\n  item: FilterModel,\n  adapterProps: AdapterProps\n): {\n  Component?: React.ElementType\n  props?: React.ComponentProps<React.ElementType>\n} => {\n  const { Component, adapter } = filterTokenAdapterMap[\n    adapterProps.config.type\n  ] || {\n    Component: undefined,\n    adapter: undefined,\n  }\n  const props = adapter?.(item, adapterProps)\n\n  return { Component, props }\n}\n\n/**\n * A map of valid filter UI types\n */\nconst filterTokenAdapterMap: Record<\n  string,\n  FilterTokenProps<React.ElementType>\n> = {\n  button_group: { Component: ButtonGroup, adapter: buttonGroupAdapter },\n  button_toggles: { Component: ButtonToggles, adapter: buttonTogglesAdapter },\n  checkboxes: { Component: CheckboxGroup, adapter: checkboxGroupAdapter },\n  date_time_range_input: { Component: DateRange, adapter: dateRangeAdapter },\n  day_picker: { Component: DateInput, adapter: dateInputAdapter },\n  day_range_picker: {\n    Component: DayRangeInput,\n    adapter: dayRangeInputAdapter,\n  },\n  dropdown_menu: { Component: DropdownMenu, adapter: dropdownMenuAdapter },\n  radio_buttons: { Component: RadioGroup, adapter: radioGroupAdapter },\n  range_slider: { Component: RangeSlider, adapter: rangeSliderAdapter },\n  relative_timeframes: {\n    Component: RelativeTimeframes,\n    adapter: relativeTimeframesAdapter,\n  },\n  slider: { Component: Slider, adapter: sliderAdapter },\n  tag_list: { Component: TagList, adapter: tagListAdapter },\n}\n\ntype FilterTokenAdapter<T extends React.ElementType> = (\n  item: FilterModel,\n  props: AdapterProps\n) => React.ComponentProps<T>\n\ntype FilterTokenProps<T extends React.ElementType> = {\n  Component: T\n  adapter: FilterTokenAdapter<T>\n}\n\nexport const TEST_ONLY = {\n  getSingleValue,\n}\n"],"mappings":"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"}