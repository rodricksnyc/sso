{"version":3,"file":"InputTimeSelect.spec.js","names":["jest","mock","fn","realDateNow","Date","now","bind","global","realScrollIntoView","window","HTMLElement","prototype","scrollIntoView","beforeEach","afterEach","resetAllMocks","extractTextFromDomList","list","options","getElementsByTagName","map","el","textContent","renderListContent","props","renderWithTheme","inputBox","screen","getByPlaceholderText","fireEvent","click","domList","getByRole","describe","test","view","format","expect","toMatchSnapshot","document","interval","handleChange","not","toHaveBeenCalled","change","target","value","keyDown","key","toHaveBeenLastCalledWith","selected","querySelector","toMatchInlineSnapshot","onChange"],"sources":["../../../../../src/Form/Inputs/InputTimeSelect/InputTimeSelect.spec.tsx"],"sourcesContent":["/*\n\n MIT License\n\n Copyright (c) 2022 Looker Data Sciences, Inc.\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in all\n copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n SOFTWARE.\n\n */\n\nimport React from 'react'\nimport { fireEvent, screen } from '@testing-library/react'\nimport { renderWithTheme } from '@looker/components-test-utils'\nimport map from 'lodash/map'\nimport type { InputTimeSelectProps } from './InputTimeSelect'\nimport { InputTimeSelect } from './InputTimeSelect'\n\njest.mock('lodash/throttle', () => (fn: any) => fn)\n\nconst realDateNow = Date.now.bind(global.Date)\n// eslint-disable-next-line @typescript-eslint/unbound-method\nconst realScrollIntoView = window.HTMLElement.prototype.scrollIntoView\n\nbeforeEach(() => {\n  // eslint-disable-next-line @typescript-eslint/unbound-method\n  window.HTMLElement.prototype.scrollIntoView = jest.fn()\n  // eslint-disable-next-line @typescript-eslint/unbound-method\n  global.Date.now = jest.fn(() => 1580567580000)\n})\n\nafterEach(() => {\n  // eslint-disable-next-line @typescript-eslint/unbound-method\n  global.Date.now = realDateNow // reset Date.now mock\n  // eslint-disable-next-line @typescript-eslint/unbound-method\n  window.HTMLElement.prototype.scrollIntoView = realScrollIntoView\n  jest.resetAllMocks()\n})\n\n// parse text content from options list\nconst extractTextFromDomList = (list: HTMLElement) => {\n  const options = list.getElementsByTagName('li')\n  return map(options, (el: HTMLElement) => {\n    return el.textContent\n  })\n}\n\nconst renderListContent = (props: InputTimeSelectProps) => {\n  renderWithTheme(<InputTimeSelect {...props} />)\n\n  // open list\n  const inputBox = screen.getByPlaceholderText('Select time')\n  fireEvent.click(inputBox)\n\n  // select list container\n  const domList = screen.getByRole('listbox')\n  return domList\n}\n\ndescribe('prop: format', () => {\n  test('formats options in 12 hour time', () => {\n    const view = renderListContent({ format: '12h' })\n    expect(extractTextFromDomList(view)).toMatchSnapshot()\n    fireEvent.click(document)\n  })\n\n  test('formats options in 24 hour time', () => {\n    const view = renderListContent({ format: '24h' })\n    expect(extractTextFromDomList(view)).toMatchSnapshot()\n    fireEvent.click(document)\n  })\n})\n\ndescribe('prop: interval', () => {\n  test('renders 5-minute intervals', () => {\n    const view = renderListContent({ interval: 5 })\n    expect(extractTextFromDomList(view)).toMatchSnapshot()\n    fireEvent.click(document)\n  })\n\n  test('renders 10-minute intervals', () => {\n    const view = renderListContent({ interval: 10 })\n    expect(extractTextFromDomList(view)).toMatchSnapshot()\n    fireEvent.click(document)\n  })\n  test('renders 15-minute intervals', () => {\n    const view = renderListContent({ interval: 15 })\n    expect(extractTextFromDomList(view)).toMatchSnapshot()\n    fireEvent.click(document)\n  })\n  test('renders 20-minute intervals', () => {\n    const view = renderListContent({ interval: 20 })\n    expect(extractTextFromDomList(view)).toMatchSnapshot()\n    fireEvent.click(document)\n  })\n  test('renders 30-minute intervals', () => {\n    const view = renderListContent({ interval: 30 })\n    expect(extractTextFromDomList(view)).toMatchSnapshot()\n    fireEvent.click(document)\n  })\n  test('renders 60-minute intervals', () => {\n    const view = renderListContent({ interval: 60 })\n    expect(extractTextFromDomList(view)).toMatchSnapshot()\n    fireEvent.click(document)\n  })\n})\n\ndescribe('text input', () => {\n  test('converts shorthand input to 24h formatted string on change', () => {\n    const handleChange = jest.fn()\n    renderWithTheme(<InputTimeSelect onChange={handleChange} />)\n\n    expect(handleChange).not.toHaveBeenCalled()\n\n    const inputBox = screen.getByPlaceholderText('Select time')\n    fireEvent.click(inputBox)\n\n    // Enter key input\n    fireEvent.change(inputBox, { target: { value: '2pm' } })\n    fireEvent.keyDown(inputBox, { key: 'Enter' })\n    expect(handleChange).toHaveBeenLastCalledWith('14:00')\n\n    // Tab key input\n    fireEvent.change(inputBox, { target: { value: '3:3' } }) // incomplete time string\n    fireEvent.keyDown(inputBox, { key: 'Tab' })\n    expect(handleChange).toHaveBeenLastCalledWith('03:03')\n\n    fireEvent.click(document)\n  })\n})\n\ndescribe('keyboard nav ux', () => {\n  test('highlights closest time to now when an unselected list is opened', () => {\n    // NOTE: Date.now() mocked to 1580517818172 (Feb 01 2020 6:33 am)\n    const view = renderListContent({})\n    const selected = view.querySelector('[aria-selected=\"true\"]')\n    expect((selected as HTMLElement).textContent).toMatchInlineSnapshot(\n      `\"06:30 am\"`\n    )\n    fireEvent.click(document)\n  })\n\n  test('highlights selected value when list is opened', () => {\n    const view = renderListContent({\n      onChange: jest.fn(),\n      value: '14:15',\n    })\n    const selected = view.querySelector('[aria-selected=\"true\"]')\n    expect((selected as HTMLElement).textContent).toMatchInlineSnapshot(\n      `\"02:15 pm\"`\n    )\n    fireEvent.click(document)\n  })\n\n  test('highlights closest time to selected value when list is opened but value does not match provided options', () => {\n    const view = renderListContent({ onChange: jest.fn(), value: '16:38' })\n    const selected = view.querySelector('[aria-selected=\"true\"]')\n    expect((selected as HTMLElement).textContent).toMatchInlineSnapshot(\n      `\"04:45 pm\"`\n    )\n    fireEvent.click(document)\n  })\n})\n"],"mappings":"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"}